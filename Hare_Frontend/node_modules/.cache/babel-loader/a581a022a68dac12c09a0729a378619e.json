{"ast":null,"code":"import React, { Component } from 'react';\nimport { Grommet, grommet, TextInput, DropButton, Button, Box, Heading, Menu, Paragraph, Carousel, Accordion, AccordionPanel, Text, Image, Distribution, Layer } from 'grommet';\nimport * as Icons from 'grommet-icons';\nimport { withRouter, Redirect, Route, Link, Router, BrowserRouter } from 'react-router-dom';\nimport Colors from './styles/Color';\nimport AuthService from './actions/AuthService';\nimport UserService from './actions/UserService';\n/*\nconst Title = (contents) => { \n\treturn(\n\t\t<Text size=\"36pt\" color={Colors.dark3}> \n\t\t\t{contents}\n\t\t</Text> \n\t); \n} \n\nclass TextInputBar extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);  \n\t\tthis.state = {};\n\t\tthis.state.value = \"\"; \n\t}\n\n\tref = React.createRef();\n\tonChange = event => { \n\t\tthis.setState({ value: event.target.value })\n\t\tthis.setName( event.target.value )\n\t};\n\n\tsetName = (name) => this.props.onSet(name); \n\n\trender() {\n\t\tconst { value } = this.state;\n\t\treturn (\n\t\t\t<Box width=\"medium\">\n\t\t\t\t<TextInput ref={this.ref} value={value} onChange={this.onChange} />\n\t\t\t</Box>\n\t\t);\n\t}\n}\n\nclass SaveModal extends Component {\n\n\tconstructor(props){ \n\t\tsuper(props); \n\t\tthis.state = {}; \n\t\tthis.state.savedName = undefined; \n\t\tthis.state.saved_id = this.props.product_id; \n\t\tthis.state.userdata = JSON.parse(localStorage.getItem('userdata'));\n\t}\n\n\tonOpen = () => this.setState({ open: true });\n\tonClose = () => this.setState({ open: undefined });\n\n\tupdateName = (name) => { \n\t\tthis.setState({savedName: name});\n\t}\n\n\tsendSave = () => {\n\t\tUserService.saveProduct(this.state.savedName, this.state.userdata, this.state.saved_id).then(res => { \n\t\t\tthis.onClose();\n\t\t})\n\t}\n\n\trenderModal = () => { \n\t\treturn(\n\t\t\t<Layer position=\"center\" modal onClickOutside={this.onClose} onEsc={this.onClose}>\n\t\t\t\t<Box direction=\"column\" pad=\"medium\" gap=\"medium\">\n\t\t\t\t\t<Box direction=\"row\" justify=\"between\">\n\t\t\t\t\t\t<Text size=\"24pt\" color={Colors.dark3}> Save Scan Results</Text>\n\t\t\t\t\t\t<Button icon={<Icons.Close color={Colors.dark3} />} onClick={this.onClose}/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Text>Save as: </Text> \n\t\t\t\t\t<TextInputBar onSet={this.updateName}/>\n\t\t\t\t\t<Button color={Colors.primary} label={<Text color={Colors.primary}>Submit</Text>} onClick={this.sendSave}/>\n\t\t\t\t</Box>\n\t\t\t</Layer>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { open } = this.state;\n\t\treturn (\t\t\t\n\t\t\t<div>\n\t\t\t\t<Button icon={<Icons.Save size=\"large\" color={Colors.dark3}/>}  onClick={this.onOpen}  plain/>\n\t\t\t\t{ open && this.renderModal()}\n\t\t\t</div>\n\t\t);\n\t}\n\n}\n\nclass IngredientModal extends Component {\n\n\tstate = {}; \n\n\tcomponentDidMount() { \n\t\tlet data = this.getIngredientData(); \n\t\tlet name = String(data.name).charAt(0).toUpperCase() + String(data.name).slice(1);\n\t\tthis.setState({ ingredientname: name, ingredientdesc: data.desc});\n\t} \n\n\tgetIngredientData = () => { \n\t\treturn this.props.ingredient; \t\n\t}\n\n\tgetColor = () => {\n\t\tif(this.props.color != undefined) {\n\t\t\treturn this.props.color; \n\t\t} else { \n\t\t\treturn;\n\t\t}\t\n\t} \n\n\tonOpen = () => this.setState({ open: true });\n\tonClose = () => this.setState({ open: undefined });\n\n\trenderModal = () => { \n\t\treturn(\n\t\t\t<Layer position=\"center\" modal onClickOutside={this.onClose} onEsc={this.onClose}>\n\t\t\t\t<Box direction=\"row\" pad={{ left: 'medium', right: 'medium', top: 'medium'}} justify=\"between\">\n\t\t\t\t\t<Text size=\"24pt\" color={Colors.dark3}> Ingredient: {this.state.ingredientname}</Text>\n\t\t\t\t\t<Button icon={<Icons.Close color={Colors.dark3} />} onClick={this.onClose}/>\n\t\t\t\t</Box>\n\t\t\t\t<Box pad=\"medium\"> \n\t\t\t\t\t<Text size=\"12pt\" > {this.state.ingredientdesc}</Text> \n\t\t\t\t</Box> \n\t\t\t</Layer>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { open } = this.state;\n\t\treturn (\t\t\t\n\t\t\t<Box direction=\"row\">\n\t\t\t\t<Button direction=\"row\" margin={{ right: \"xsmall\" }} label={<Text size=\"10pt\"  color={this.getColor()}>{`${this.state.ingredientname},`}</Text>}  onClick={this.onOpen} plain />\n\t\t\t\t{ open && this.renderModal()}\n\t\t\t</Box>\n\t\t);\n\t}\n\n}\n\nconst renderIngredientIcon = (preferences, ingredientlist) => { \n\tlet ingredientbuttons = []; \n\tlet pref_colors = {\n\t\t0: \"\", \n\t\t1: \"red\",\n\t\t2: \"blue\", \n\t\t3: \"green\", \n\t\t4: \"purple\", \n\t\t5: \"#33D1FF\", \n\t} \n\tlet match = false;\n\tlet color = \"\";\n\tlet col_index = 0; \n\tingredientlist.forEach(function (item) {\n\t\tif(preferences != null ) {\n\t\t\tmatch = false; \n\t\t\tObject.keys(preferences.special).forEach(function(key, index) {\n\t\t\t\tif(preferences.special[key].name == item.name) { \n\t\t\t\t\tmatch = true;\n\t\t\t\t\tcol_index = preferences.special[index].color;\n\t\t\t\t\tcolor = pref_colors[col_index]; \n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif(match == true) { \n\t\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} color={color} />); \n\t\t\t} else {\n\t\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} />); \n\t\t\t}\n\t\t} else { \n\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} />);\n\t\t} \n\t});\n\n\treturn(\n\t\t<Box direction=\"row\" wrap>\n\t\t\t{ingredientbuttons}\n\t\t</Box> \n\t); \n} \n\nclass ProductPage extends Component { \n\n\tconstructor(props) {  \n\t\tsuper(props); \n\t\t\n\t\t// Authentication values \n\t\tlet authval = AuthService.hasAuthKey(); \n\t\tthis.state = {}; \n\t\tthis.state.auth = authval;\n\t\t\n\t\t// If logged in, get prefs \n\t\tif(authval == true) { \n\t\t\t// Update preferences, then get userdata. \n\t\t\tAuthService.setAuthKey(localStorage.getItem('auth'));\n\t\t\tthis.state.userdata = JSON.parse(localStorage.getItem('userdata'));\n\t\t} else { \n\t\t\tthis.state.userdata = undefined; \n\t\t}\n\n\t\t// Get product data from LS \n\t\tlet idnum = this.props.location.pathname; \n\t\tidnum = idnum.split(\"/\");\n\t\tidnum = idnum[2];\n\t\tthis.state.product_id = idnum; \n\t\t\tthis.state.productpage = JSON.parse(localStorage.getItem(this.state.product_id));\n\t\t\tconsole.log(this.state);\n\t\t\tif(this.state.productpage == null || this.state.productpage === undefined) { \n\t\t\t\tthis.props.history.push('/404');\n\t\t\t}\n\n\t} \n\n\tgetImageB64 = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tconst obj = this.state.productpage; \n\t\tconst binary = obj.img_url; \n\t\treturn binary; \n\t} \n\n\trenderIngredientsNormally = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tconst obj = this.state.productpage; \n\t\tlet ingredients = obj.contents; \n\t\tlet panels = []; \n\t\tObject.keys(ingredients).forEach(function(key,index) {\n\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\tpanels.push( \n\t\t\t\t\t(\n\t\t\t\t\t\t<AccordionPanel label={key} wrap>\n\t\t\t\t\t\t\t{renderIngredientIcon(null, ingredients[key])}  \n\t\t\t\t\t\t</AccordionPanel> \n\t\t\t\t\t)\n\t\t\t\t) \n\t\t\t} \n\t\t});\n\n\t\treturn( \n\t\t\t<Accordion> \n\t\t\t\t{panels}\t\n\t\t\t</Accordion> \n\t\t); \n\t} \n\n\trenderIngredientsPreferenced = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t} \n\t\tconst product_obj = this.state.productpage; \n\t\tconst userdata = this.state.userdata;\n\t\tlet ingredients = product_obj.contents;\n\t\tlet panels = []; \n\n\t\tObject.keys(ingredients).forEach(function(key, index) { \n\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\tpanels.push( \n\t\t\t\t\t<AccordionPanel label={key}> \n\t\t\t\t\t\t{renderIngredientIcon(userdata.preferences, ingredients[key])} \n\t\t\t\t\t</AccordionPanel> \n\t\t\t\t); \n\t\t\t} \n\t\t}); \n\n\t\treturn( \n\t\t\t<Accordion>\t\t\n\t\t\t\t{panels} \n\t\t\t</Accordion> \n\t\t); \n\t} \n\n\trenderDistribution = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tlet dist_content = [];\n\t\tconst obj = this.state.productpage; \n\t\tlet ingredients = obj.contents;\n\t\tlet max = 0; \n\t\tObject.keys(ingredients).forEach(function(key,index) {\n\t\t\tlet curr_obj = {}; \n\t\t\tif(dist_content.length < 5) { \n\t\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\t\tcurr_obj = { value: Number(ingredients[key].length), label: String(key) };\n\t\t\t\t\tdist_content.push(curr_obj);\n\t\t\t\t\tmax += ingredients[key].length; \n\t\t\t\t} \n\t\t\t}\n\t\t});\n\t\tdist_content.sort(); \n\n\t\treturn( \n\t\t\t<Box width=\"400px\" > \n\t\t\t\t<Distribution width=\"400px\" values={dist_content}> \n\t\t\t\t{ value => (\n\t\t\t\t\t<Box pad=\"small\" background={Colors.primary} fill>\n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.grey3}>{value.value} {value.label}</Text>\n\t\t\t\t\t</Box>\n\t\t\t\t)}  \n\t\t\t</Distribution>\n\t\t</Box> \n\t\t);\n\t} \n\n\trenderProductPage = () => {\n\t\treturn( \n\t\t\t<Box direction=\"column\" pad=\"medium\" align=\"center\" width=\"625px\" fill>\n\t\t\t\t<Box direction=\"row\" gap=\"medium\" justify=\"between\"> \n\t\t\t\t\t<Carousel pad=\"medium\">\n\t\t\t\t\t\t<Image fit=\"cover\" alt=\"Image not found\" src={`${this.getImageB64()}`} height=\"200px\" width=\"200px\"/>\n\t\t\t\t\t</Carousel>\n\t\t\t\t\t{this.renderDistribution()}\n\t\t\t\t</Box>\n\n\t\t\t\t<Box margin=\"medium\"  width=\"625px\">\n\t\t\t\t\t{eval(this.state.auth) ? (this.renderIngredientsPreferenced()): ( this.renderIngredientsNormally() )}\n\t\t\t\t</Box>\n\t\t\t</Box> \n\t\t); \n\t} \n\n\n\n\trender() { \n\n\t\tif(this.state.productpage === undefined || this.state.productpage === null) { \n\t\t\treturn(<Redirect to='/404'/>)\n\t\t}\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<Box margin=\"large\" justify=\"center\" align=\"center\">\n\t\t\t\t\t<Box justify=\"between\" width=\"100%\" direction=\"row\"> \n\t\t\t\t\t\t<Box width=\"33%\"  justify=\"center\" align=\"start\"   pad={{ left: \"large\" }}>\n\t\t\t\t\t\t\t<Link to='/upload'>\n\t\t\t\t\t\t\t\t{<Icons.LinkPrevious color={Colors.dark3} size=\"large\" justify=\"left\" align=\"left\"/>}\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t<Box width=\"33%\" justify=\"center\" align=\"center\"> \n\t\t\t\t\t\t\t{Title(\"Scan Results:\")}\n\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t<Box direction=\"row\" width=\"33%\" justify=\"start\" pad={{ left: \"medium\" }}>\n\t\t\t\t\t\t\t<Box direction=\"column\" align=\"center\"> \n\t\t\t\t\t\t\t\t{eval(this.state.auth) && <SaveModal product_id={this.state.product_id}/>}\n\t\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t</Box> \n\t\t\t\t\t</Box> \n\t\t\t\t\t<div> \n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.grey1}> Not sure how it works? You can find a guide </Text> \n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.primary}>here</Text>\n\t\t\t\t\t</div> \n\t\t\t\t\t<Box direction=\"row\" justify=\"start\" width=\"23.5%\"> \n\t\t\t\t\t\t<Box width=\"10%\"/>\n\t\t\t\t\t</Box> \n\t\t\t\t</Box>\n\t\t\t</div>\n\t\t);\t\n\t}\n} */\n\nexport default withRouter(ProductPage);","map":{"version":3,"sources":["/Users/michaelwlloyd/Desktop/NeoHare/Hare_Frontend/src/components/Product.js"],"names":["React","Component","Grommet","grommet","TextInput","DropButton","Button","Box","Heading","Menu","Paragraph","Carousel","Accordion","AccordionPanel","Text","Image","Distribution","Layer","Icons","withRouter","Redirect","Route","Link","Router","BrowserRouter","Colors","AuthService","UserService","ProductPage"],"mappings":"AACA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,EAAkBC,OAAlB,EAA2BC,SAA3B,EAAsCC,UAAtC,EAAkDC,MAAlD,EAA0DC,GAA1D,EAA+DC,OAA/D,EAAwEC,IAAxE,EAA8EC,SAA9E,EAAyFC,QAAzF,EAAmGC,SAAnG,EAA8GC,cAA9G,EAA8HC,IAA9H,EAAoIC,KAApI,EAA2IC,YAA3I,EAAyJC,KAAzJ,QAAsK,SAAtK;AACA,OAAO,KAAKC,KAAZ,MAAuB,eAAvB;AACA,SAASC,UAAT,EAAqBC,QAArB,EAA+BC,KAA/B,EAAsCC,IAAtC,EAA4CC,MAA5C,EAAoDC,aAApD,QAAyE,kBAAzE;AAEA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,OAAOC,WAAP,MAAwB,uBAAxB;AACA,OAAOC,WAAP,MAAwB,uBAAxB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuWA,eAAeR,UAAU,CAACS,WAAD,CAAzB","sourcesContent":["\nimport React, { Component } from 'react'; \nimport { Grommet, grommet, TextInput, DropButton, Button, Box, Heading, Menu, Paragraph, Carousel, Accordion, AccordionPanel, Text, Image, Distribution, Layer } from 'grommet';\nimport * as Icons from 'grommet-icons';\nimport { withRouter, Redirect, Route, Link, Router, BrowserRouter } from 'react-router-dom';\n\nimport Colors from './styles/Color'; \nimport AuthService from './actions/AuthService'; \nimport UserService from './actions/UserService';\n\n/*\nconst Title = (contents) => { \n\treturn(\n\t\t<Text size=\"36pt\" color={Colors.dark3}> \n\t\t\t{contents}\n\t\t</Text> \n\t); \n} \n\nclass TextInputBar extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);  \n\t\tthis.state = {};\n\t\tthis.state.value = \"\"; \n\t}\n\n\tref = React.createRef();\n\tonChange = event => { \n\t\tthis.setState({ value: event.target.value })\n\t\tthis.setName( event.target.value )\n\t};\n\n\tsetName = (name) => this.props.onSet(name); \n\n\trender() {\n\t\tconst { value } = this.state;\n\t\treturn (\n\t\t\t<Box width=\"medium\">\n\t\t\t\t<TextInput ref={this.ref} value={value} onChange={this.onChange} />\n\t\t\t</Box>\n\t\t);\n\t}\n}\n\nclass SaveModal extends Component {\n\n\tconstructor(props){ \n\t\tsuper(props); \n\t\tthis.state = {}; \n\t\tthis.state.savedName = undefined; \n\t\tthis.state.saved_id = this.props.product_id; \n\t\tthis.state.userdata = JSON.parse(localStorage.getItem('userdata'));\n\t}\n\n\tonOpen = () => this.setState({ open: true });\n\tonClose = () => this.setState({ open: undefined });\n\n\tupdateName = (name) => { \n\t\tthis.setState({savedName: name});\n\t}\n\n\tsendSave = () => {\n\t\tUserService.saveProduct(this.state.savedName, this.state.userdata, this.state.saved_id).then(res => { \n\t\t\tthis.onClose();\n\t\t})\n\t}\n\n\trenderModal = () => { \n\t\treturn(\n\t\t\t<Layer position=\"center\" modal onClickOutside={this.onClose} onEsc={this.onClose}>\n\t\t\t\t<Box direction=\"column\" pad=\"medium\" gap=\"medium\">\n\t\t\t\t\t<Box direction=\"row\" justify=\"between\">\n\t\t\t\t\t\t<Text size=\"24pt\" color={Colors.dark3}> Save Scan Results</Text>\n\t\t\t\t\t\t<Button icon={<Icons.Close color={Colors.dark3} />} onClick={this.onClose}/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Text>Save as: </Text> \n\t\t\t\t\t<TextInputBar onSet={this.updateName}/>\n\t\t\t\t\t<Button color={Colors.primary} label={<Text color={Colors.primary}>Submit</Text>} onClick={this.sendSave}/>\n\t\t\t\t</Box>\n\t\t\t</Layer>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { open } = this.state;\n\t\treturn (\t\t\t\n\t\t\t<div>\n\t\t\t\t<Button icon={<Icons.Save size=\"large\" color={Colors.dark3}/>}  onClick={this.onOpen}  plain/>\n\t\t\t\t{ open && this.renderModal()}\n\t\t\t</div>\n\t\t);\n\t}\n\n}\n\nclass IngredientModal extends Component {\n\n\tstate = {}; \n\n\tcomponentDidMount() { \n\t\tlet data = this.getIngredientData(); \n\t\tlet name = String(data.name).charAt(0).toUpperCase() + String(data.name).slice(1);\n\t\tthis.setState({ ingredientname: name, ingredientdesc: data.desc});\n\t} \n\n\tgetIngredientData = () => { \n\t\treturn this.props.ingredient; \t\n\t}\n\n\tgetColor = () => {\n\t\tif(this.props.color != undefined) {\n\t\t\treturn this.props.color; \n\t\t} else { \n\t\t\treturn;\n\t\t}\t\n\t} \n\n\tonOpen = () => this.setState({ open: true });\n\tonClose = () => this.setState({ open: undefined });\n\n\trenderModal = () => { \n\t\treturn(\n\t\t\t<Layer position=\"center\" modal onClickOutside={this.onClose} onEsc={this.onClose}>\n\t\t\t\t<Box direction=\"row\" pad={{ left: 'medium', right: 'medium', top: 'medium'}} justify=\"between\">\n\t\t\t\t\t<Text size=\"24pt\" color={Colors.dark3}> Ingredient: {this.state.ingredientname}</Text>\n\t\t\t\t\t<Button icon={<Icons.Close color={Colors.dark3} />} onClick={this.onClose}/>\n\t\t\t\t</Box>\n\t\t\t\t<Box pad=\"medium\"> \n\t\t\t\t\t<Text size=\"12pt\" > {this.state.ingredientdesc}</Text> \n\t\t\t\t</Box> \n\t\t\t</Layer>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { open } = this.state;\n\t\treturn (\t\t\t\n\t\t\t<Box direction=\"row\">\n\t\t\t\t<Button direction=\"row\" margin={{ right: \"xsmall\" }} label={<Text size=\"10pt\"  color={this.getColor()}>{`${this.state.ingredientname},`}</Text>}  onClick={this.onOpen} plain />\n\t\t\t\t{ open && this.renderModal()}\n\t\t\t</Box>\n\t\t);\n\t}\n\n}\n\nconst renderIngredientIcon = (preferences, ingredientlist) => { \n\tlet ingredientbuttons = []; \n\tlet pref_colors = {\n\t\t0: \"\", \n\t\t1: \"red\",\n\t\t2: \"blue\", \n\t\t3: \"green\", \n\t\t4: \"purple\", \n\t\t5: \"#33D1FF\", \n\t} \n\tlet match = false;\n\tlet color = \"\";\n\tlet col_index = 0; \n\tingredientlist.forEach(function (item) {\n\t\tif(preferences != null ) {\n\t\t\tmatch = false; \n\t\t\tObject.keys(preferences.special).forEach(function(key, index) {\n\t\t\t\tif(preferences.special[key].name == item.name) { \n\t\t\t\t\tmatch = true;\n\t\t\t\t\tcol_index = preferences.special[index].color;\n\t\t\t\t\tcolor = pref_colors[col_index]; \n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif(match == true) { \n\t\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} color={color} />); \n\t\t\t} else {\n\t\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} />); \n\t\t\t}\n\t\t} else { \n\t\t\tingredientbuttons.push(<IngredientModal ingredient={item} />);\n\t\t} \n\t});\n\n\treturn(\n\t\t<Box direction=\"row\" wrap>\n\t\t\t{ingredientbuttons}\n\t\t</Box> \n\t); \n} \n\nclass ProductPage extends Component { \n\n\tconstructor(props) {  \n\t\tsuper(props); \n\t\t\n\t\t// Authentication values \n\t\tlet authval = AuthService.hasAuthKey(); \n\t\tthis.state = {}; \n\t\tthis.state.auth = authval;\n\t\t\n\t\t// If logged in, get prefs \n\t\tif(authval == true) { \n\t\t\t// Update preferences, then get userdata. \n\t\t\tAuthService.setAuthKey(localStorage.getItem('auth'));\n\t\t\tthis.state.userdata = JSON.parse(localStorage.getItem('userdata'));\n\t\t} else { \n\t\t\tthis.state.userdata = undefined; \n\t\t}\n\n\t\t// Get product data from LS \n\t\tlet idnum = this.props.location.pathname; \n\t\tidnum = idnum.split(\"/\");\n\t\tidnum = idnum[2];\n\t\tthis.state.product_id = idnum; \n\t\t\tthis.state.productpage = JSON.parse(localStorage.getItem(this.state.product_id));\n\t\t\tconsole.log(this.state);\n\t\t\tif(this.state.productpage == null || this.state.productpage === undefined) { \n\t\t\t\tthis.props.history.push('/404');\n\t\t\t}\n\n\t} \n\n\tgetImageB64 = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tconst obj = this.state.productpage; \n\t\tconst binary = obj.img_url; \n\t\treturn binary; \n\t} \n\n\trenderIngredientsNormally = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tconst obj = this.state.productpage; \n\t\tlet ingredients = obj.contents; \n\t\tlet panels = []; \n\t\tObject.keys(ingredients).forEach(function(key,index) {\n\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\tpanels.push( \n\t\t\t\t\t(\n\t\t\t\t\t\t<AccordionPanel label={key} wrap>\n\t\t\t\t\t\t\t{renderIngredientIcon(null, ingredients[key])}  \n\t\t\t\t\t\t</AccordionPanel> \n\t\t\t\t\t)\n\t\t\t\t) \n\t\t\t} \n\t\t});\n\n\t\treturn( \n\t\t\t<Accordion> \n\t\t\t\t{panels}\t\n\t\t\t</Accordion> \n\t\t); \n\t} \n\n\trenderIngredientsPreferenced = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t} \n\t\tconst product_obj = this.state.productpage; \n\t\tconst userdata = this.state.userdata;\n\t\tlet ingredients = product_obj.contents;\n\t\tlet panels = []; \n\n\t\tObject.keys(ingredients).forEach(function(key, index) { \n\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\tpanels.push( \n\t\t\t\t\t<AccordionPanel label={key}> \n\t\t\t\t\t\t{renderIngredientIcon(userdata.preferences, ingredients[key])} \n\t\t\t\t\t</AccordionPanel> \n\t\t\t\t); \n\t\t\t} \n\t\t}); \n\n\t\treturn( \n\t\t\t<Accordion>\t\t\n\t\t\t\t{panels} \n\t\t\t</Accordion> \n\t\t); \n\t} \n\n\trenderDistribution = () => {\n\t\twhile(this.state.productpage == null) { \n\t\t\tsetInterval(() => {}, 500);\n\t\t}\n\t\tlet dist_content = [];\n\t\tconst obj = this.state.productpage; \n\t\tlet ingredients = obj.contents;\n\t\tlet max = 0; \n\t\tObject.keys(ingredients).forEach(function(key,index) {\n\t\t\tlet curr_obj = {}; \n\t\t\tif(dist_content.length < 5) { \n\t\t\t\tif(ingredients[key].length != 0 && key != null) { \n\t\t\t\t\tcurr_obj = { value: Number(ingredients[key].length), label: String(key) };\n\t\t\t\t\tdist_content.push(curr_obj);\n\t\t\t\t\tmax += ingredients[key].length; \n\t\t\t\t} \n\t\t\t}\n\t\t});\n\t\tdist_content.sort(); \n\n\t\treturn( \n\t\t\t<Box width=\"400px\" > \n\t\t\t\t<Distribution width=\"400px\" values={dist_content}> \n\t\t\t\t{ value => (\n\t\t\t\t\t<Box pad=\"small\" background={Colors.primary} fill>\n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.grey3}>{value.value} {value.label}</Text>\n\t\t\t\t\t</Box>\n\t\t\t\t)}  \n\t\t\t</Distribution>\n\t\t</Box> \n\t\t);\n\t} \n\n\trenderProductPage = () => {\n\t\treturn( \n\t\t\t<Box direction=\"column\" pad=\"medium\" align=\"center\" width=\"625px\" fill>\n\t\t\t\t<Box direction=\"row\" gap=\"medium\" justify=\"between\"> \n\t\t\t\t\t<Carousel pad=\"medium\">\n\t\t\t\t\t\t<Image fit=\"cover\" alt=\"Image not found\" src={`${this.getImageB64()}`} height=\"200px\" width=\"200px\"/>\n\t\t\t\t\t</Carousel>\n\t\t\t\t\t{this.renderDistribution()}\n\t\t\t\t</Box>\n\n\t\t\t\t<Box margin=\"medium\"  width=\"625px\">\n\t\t\t\t\t{eval(this.state.auth) ? (this.renderIngredientsPreferenced()): ( this.renderIngredientsNormally() )}\n\t\t\t\t</Box>\n\t\t\t</Box> \n\t\t); \n\t} \n\n\n\n\trender() { \n\n\t\tif(this.state.productpage === undefined || this.state.productpage === null) { \n\t\t\treturn(<Redirect to='/404'/>)\n\t\t}\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<Box margin=\"large\" justify=\"center\" align=\"center\">\n\t\t\t\t\t<Box justify=\"between\" width=\"100%\" direction=\"row\"> \n\t\t\t\t\t\t<Box width=\"33%\"  justify=\"center\" align=\"start\"   pad={{ left: \"large\" }}>\n\t\t\t\t\t\t\t<Link to='/upload'>\n\t\t\t\t\t\t\t\t{<Icons.LinkPrevious color={Colors.dark3} size=\"large\" justify=\"left\" align=\"left\"/>}\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t<Box width=\"33%\" justify=\"center\" align=\"center\"> \n\t\t\t\t\t\t\t{Title(\"Scan Results:\")}\n\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t<Box direction=\"row\" width=\"33%\" justify=\"start\" pad={{ left: \"medium\" }}>\n\t\t\t\t\t\t\t<Box direction=\"column\" align=\"center\"> \n\t\t\t\t\t\t\t\t{eval(this.state.auth) && <SaveModal product_id={this.state.product_id}/>}\n\t\t\t\t\t\t\t</Box> \n\t\t\t\t\t\t</Box> \n\t\t\t\t\t</Box> \n\t\t\t\t\t<div> \n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.grey1}> Not sure how it works? You can find a guide </Text> \n\t\t\t\t\t\t<Text size=\"12pt\" color={Colors.primary}>here</Text>\n\t\t\t\t\t</div> \n\t\t\t\t\t<Box direction=\"row\" justify=\"start\" width=\"23.5%\"> \n\t\t\t\t\t\t<Box width=\"10%\"/>\n\t\t\t\t\t</Box> \n\t\t\t\t</Box>\n\t\t\t</div>\n\t\t);\t\n\t}\n} */\n\nexport default withRouter(ProductPage); \n"]},"metadata":{},"sourceType":"module"}